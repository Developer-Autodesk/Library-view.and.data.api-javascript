var Autodesk=Autodesk||{};Autodesk.ADN=Autodesk.ADN||{},Autodesk.ADN.Toolkit=Autodesk.ADN.Toolkit||{},Autodesk.ADN.Toolkit.ViewAndData=Autodesk.ADN.Toolkit.ViewAndData||{},Autodesk.ADN.Toolkit.ViewAndData.ViewAndDataClient=function(e,t){function s(e){switch(e){case 200:return"Success";case 400:return"The request could not be understood by the server due to malformed syntax or missing request headers. The client SHOULD NOT repeat the request without modification.";case 401:return"The supplied authorization header was not valid or the supplied token scope was not acceptable. Verify authentication and try again.";case 403:return"The authorization was successfully validated but permission is not granted.  Do not try again unless you resolve permissions first.";case 404:return"Object does not exist.";case 409:return"Object already exists.";case 423:return"Server is busy.  Please retry after some time.";case 500:return"Internal failure while processing the request, reason depends on error.";default:return"Unknown error."}}var n=t,a=null,r=null,o=e,i=function(e,t){try{var r=new XMLHttpRequest;r.open("GET",n,!0),r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status)try{var n=JSON.parse(r.responseText);e(n)}catch(o){a=""}else t({status:r.status,description:s(r.status),response:r.responseText})},r.send(null)}catch(o){t(o)}};i(function(e){var t=arguments.callee;setTimeout(function(){i(t)},1e3*e.expires_in),a=e,r&&(r(),r=null)},function(e){console.log("ViewAndDataClient error requesting token: "+e)}),this.onInitialized=function(e){a?e():r=e},this.setToken=function(){var e={oauth2:{token:a.access_token}},t=new XMLHttpRequest;t.open("POST",o+"/derivativeservice/v2/token",!1),t.setRequestHeader("Content-Type","application/json"),t.withCredentials=!0,t.send(JSON.stringify(e))},this.createBucketAsync=function(e,t,n){try{var r=new XMLHttpRequest;r.open("POST",o+"/oss/v2/buckets",!0),r.setRequestHeader("Authorization","Bearer "+a.access_token),r.setRequestHeader("Content-Type","application/json"),r.onreadystatechange=function(){4==r.readyState&&(200==r.status?t(JSON.parse(r.responseText)):n({status:r.status,description:s(r.status),response:JSON.parse(r.responseText)}))},r.send(JSON.stringify(e))}catch(i){n(i)}},this.getBucketDetailsAsync=function(e,t,n){try{var r=new XMLHttpRequest;r.open("GET",o+"/oss/v1/buckets/"+e+"/details",!0),r.setRequestHeader("Authorization","Bearer "+a.access_token),r.setRequestHeader("Content-Type","application/json"),r.onreadystatechange=function(){4==r.readyState&&(200==r.status?t(JSON.parse(r.responseText)):n({status:r.status,description:s(r.status),response:JSON.parse(r.responseText)}))},r.send()}catch(i){n(i)}},this.uploadFileAsync=function(e,t,s,n,r){var i=new XMLHttpRequest;i.open("PUT",o+"/oss/v2/buckets/"+t+"/objects/"+s,!0),i.setRequestHeader("Authorization","Bearer "+a.access_token),i.setRequestHeader("Content-Type","application/stream"),i.onload=function(){var t=JSON.parse(i.responseText);t.file=e,n(t)};var u=new FileReader;u.onerror=r,u.onabort=r,u.onloadend=function(e){if(e.target.readyState==FileReader.DONE)try{i.send(e.target.result)}catch(t){r(t)}else r(e)};var c=e.slice(0,e.size);u.readAsArrayBuffer(c)},this.registerAsync=function(e,t,n){try{var r=new XMLHttpRequest;r.open("POST",o+"/derivativeservice/v2/registration",!0),r.setRequestHeader("Authorization","Bearer "+a.access_token),r.setRequestHeader("Content-Type","application/json");var i={design:this.toBase64(e)};r.onreadystatechange=function(){4==r.readyState&&(200==r.status?t(JSON.parse(r.responseText)):n({status:r.status,description:s(r.status),response:JSON.parse(r.statusText)}))},r.send(JSON.stringify(i))}catch(u){n(u)}},this.register=function(e){var t=new XMLHttpRequest;t.open("POST",o+"/derivativeservice/v2/registration",!1),t.setRequestHeader("Authorization","Bearer "+a.access_token),t.setRequestHeader("Content-Type","application/json");var s={design:this.toBase64(e)};try{return t.send(JSON.stringify(s)),JSON.parse(t.responseText)}catch(n){return n}},this.getThumbnailAsync=function(e,t,n,r,i,u){try{var c=new XMLHttpRequest;c.open("GET",o+"/derivativeservice/v2/thumbnails/"+this.toBase64(e),!0),c.setRequestHeader("Authorization","Bearer "+a.access_token),c.responseType="arraybuffer",c.onload=function(){if(200==this.status){var e=btoa(String.fromCharCode.apply(null,new Uint8Array(this.response)));t(e)}else n({status:c.status,description:s(c.status),response:""})},c.send()}catch(d){n(d)}},this.getViewableAsync=function(e,t,n,r,i){try{var u=i?"?guid="+i:"",c="";switch(r){case"status":c="/status";break;case"all":c="/all"}var d=new XMLHttpRequest;d.open("GET",o+"/derivativeservice/v2/manifest/"+this.toBase64(e)+c+u,!0),d.setRequestHeader("Authorization","Bearer "+a.access_token),d.onreadystatechange=function(){4==d.readyState&&(200==d.status?t(JSON.parse(d.responseText)):n({status:d.status,description:s(d.status),response:JSON.parse(d.responseText)}))},d.send()}catch(p){n(p)}},this.getSubItemsWithProperties=function(e,t,s,n){function a(e,t){var s=!0;for(var n in t){if(!e.hasOwnProperty(n)){s=!1;break}if(e[n]!==t[n]){s=!1;break}}return s}function r(e,t){var s=[];if(a(e,t)&&s.push(e),"undefined"!=typeof e.children)for(var n=0;n<e.children.length;++n){var o=r(e.children[n],t);s=s.concat(o)}return s}this.getViewableAsync(e,function(e){var n=r(e,t);s(n)},n,"all")},this.toBase64=function(e){return window.btoa(unescape(encodeURIComponent(e)))},this.fromBase64=function(e){return decodeURIComponent(escape(window.atob(e)))}};